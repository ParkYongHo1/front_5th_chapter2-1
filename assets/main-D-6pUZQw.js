import"./modulepreload-polyfill-B5Qt9EMX.js";const v=t=>!t||t.q<=0?(alert("재고가 부족합니다."),!1):!0,y=(t,e,a)=>{const n=t.getState();t.update({products:n.products.map(o=>o.id===e?{...o,q:o.q-a}:o)})},I=(t,e)=>e>=10?t.discountRate??0:0,S=({subTotal:t,totalAmt:e,itemCount:a,items:n})=>{if(a<30){const r=t===0?0:(t-e)/t;return{total:e,discountRate:r,items:n}}const o=t*.25,s=t-e;if(o>s)return{total:t*.75,discountRate:.25,items:n};const c=(t-e)/t;return{total:e,discountRate:c,items:n}},b=({currentTotal:t,currentRate:e,items:a})=>new Date().getDay()!==2?{total:t,discountRate:e,items:a}:{total:t*.9,discountRate:Math.max(e,.1),items:a},q=(t,e,a)=>{const n=e.id,o=parseInt(e.querySelector("span").textContent.split("x ")[1],10),s=a.find(l=>l.id===n),d=s.val*o,c=I(s,o),r=d*(1-c),u=new Map(t.items);return u.set(n,{quantity:o,product:s}),{...t,items:u,subTotal:t.subTotal+d,totalAmt:t.totalAmt+r,itemCount:t.itemCount+o}},C=(t,e)=>{e.wrapper.append(e.title,e.cartDisplay,e.total,e.productSelect,e.addButton,e.stockInfo),e.container.appendChild(e.wrapper),t.appendChild(e.container)},m=t=>parseInt(t.querySelector("span").textContent.split("x ")[1]),R=t=>t.classList.contains("remove-item")?"remove":t.classList.contains("quantity-change")?"change":null,i=(t,{id:e,className:a,textContent:n}={})=>{const o=document.createElement(t);return e&&(o.id=e),a&&(o.className=a),n&&(o.textContent=n),o},f=(t,e,a)=>{t.querySelector("span").textContent=`${e.name} - ${e.val}원 x ${a}`},g=(t,e,a)=>{const n=m(t);t.remove();const o=a.getState();a.update({products:o.products.map(s=>s.id===e?{...s,q:s.q+n}:s)})},w=(t,e,a,n)=>{if(a>0&&e.q<=0){alert("재고가 부족합니다.");return}const s=m(t)+a;if(s<=0){g(t,e.id,n);return}f(t,e,s);const d=n.getState();n.update({products:d.products.map(c=>c.id===e.id?{...c,q:c.q-a}:c)})},k=(t,e)=>{const a={subTotal:0,totalAmt:0,itemCount:0,items:new Map},{subTotal:n,totalAmt:o,itemCount:s,items:d}=t.reduce((u,l)=>q(u,l,e),a),c=S({subTotal:n,totalAmt:o,itemCount:s,items:d}),r=b({currentTotal:c.total,currentRate:c.discountRate,items:c.items});return{total:r.total,discountRate:r.discountRate,count:s,items:r.items}},D=t=>{const e=i("div",{id:t.id,className:"flex justify-between items-center mb-2"});return e.innerHTML=`
      <span>${t.name} - ${t.val}원 x 1</span>
      <div>
        <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
          data-product-id="${t.id}" data-change="-1">-</button>
        <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" 
          data-product-id="${t.id}" data-change="1">+</button>
        <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" 
          data-product-id="${t.id}">삭제</button>
      </div>
    `,e},p=(t,e)=>{const a=e.filter(n=>n.q<5);t.textContent=a.map(n=>`${n.name}: ${n.q>0?`재고 부족 (${n.q}개 남음)`:"품절"}`).join(`
`)},h=(t,e,a=0)=>{if(e.innerHTML=`총액: ${Math.round(t)}원`,a>0){const o=i("span",{className:"text-green-500 ml-2",textContent:`(${(a*100).toFixed(1)}% 할인 적용)`});e.appendChild(o)}let n=document.getElementById("loyalty-points");n||(n=i("span",{id:"loyalty-points",className:"text-blue-500 ml-2"}),e.appendChild(n)),n.textContent=`(포인트: ${Math.floor(t/1e3)})`},x=(t,e)=>{const a=k(Array.from(t.cartDisplay.children),e.getState().products);h(a.total,t.total,a.discountRate),p(t.stockInfo,e.getState().products)},$=(t,e)=>{t.addButton.addEventListener("click",()=>{const a=e.getState(),n=t.productSelect.value,o=a.products.find(d=>d.id===n);if(!v(o))return;const s=document.getElementById(n);if(s){const d=m(s),c=d+1;if(c>o.q+d){alert("재고가 부족합니다.");return}f(s,o,c),y(e,o.id,1)}else t.cartDisplay.appendChild(D(o)),y(e,o.id,1);x(t,e)})},B=(t,e)=>{t.cartDisplay.addEventListener("click",a=>{const n=a.target;if(!n.matches("button"))return;const o=e.getState(),s=n.dataset.productId,d=document.getElementById(s),c=o.products.find(u=>u.id===s);switch(R(n)){case"remove":g(d,s,e);break;case"change":w(d,c,parseInt(n.dataset.change),e);break;default:return}x(t,e)})},M=(t,e)=>{t.innerHTML="",e.forEach(a=>{const n=i("option");n.value=a.id,n.textContent=`${a.name} - ${a.val}원`,n.disabled=a.q===0,t.appendChild(n)})},E=()=>({container:i("div",{className:"bg-gray-100 p-8"}),wrapper:i("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8"}),title:i("h1",{className:"text-2xl font-bold mb-4",textContent:"장바구니"}),cartDisplay:i("div",{id:"cart-items"}),total:i("div",{id:"cart-total",className:"text-xl font-bold my-4"}),productSelect:i("select",{id:"product-select",className:"border rounded p-2 mr-2"}),addButton:i("button",{id:"add-to-cart",className:"bg-blue-500 text-white px-4 py-2 rounded",textContent:"추가"}),stockInfo:i("div",{id:"stock-status",className:"text-sm text-gray-500 mt-2"})}),N=[{id:"p1",name:"상품1",val:1e4,q:50,discountRate:.1},{id:"p2",name:"상품2",val:2e4,q:30,discountRate:.15},{id:"p3",name:"상품3",val:3e4,q:20,discountRate:.2},{id:"p4",name:"상품4",val:15e3,q:0,discountRate:.05},{id:"p5",name:"상품5",val:25e3,q:10,discountRate:.25}],T=t=>{const e={...t},a=new Set;return{getState:()=>e,update:n=>{Object.assign(e,n),a.forEach(o=>o(e))}}},L=(t,e)=>{setTimeout(function(){setInterval(function(){var a=t[Math.floor(Math.random()*t.length)];Math.random()<.3&&a.q>0&&(a.val=Math.round(a.val*.8),alert("번개세일! "+a.name+"이(가) 20% 할인 중입니다!"),e())},3e4)},Math.random()*1e4)},Q=(t,e,a)=>{setTimeout(function(){setInterval(function(){},6e4)},Math.random()*2e4)};function A(){const t=T({products:[...N]}),e=()=>{p(n.stockInfo,t.getState().products)},a=document.getElementById("app"),n=E();C(a,n),M(n.productSelect,t.getState().products),h(0,n.total),p(n.stockInfo,t.getState().products),$(n,t),B(n,t),L(t.getState().products,e),Q(t.getState().products)}A();
